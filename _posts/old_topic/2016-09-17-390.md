---
layout: post
title: graylog的sidercar与nxlog部署
description: graylog的sidercar与nxlog部署
date:   2016-09-17 22:50:18 +0800 
tags: [lua]
categories: [topic]
---
graylog的sidercar与nxlog部署


1.去github上下载sidercar.


2.配置sidercar的配置文件。

```
server_url: http://192.168.0.3:9100/api 
update_interval: 10
tls_skip_verify: false
send_status: true
list_log_files:
node_id: graylog-collector-sidecar
collector_id: file:C:\Program Files\graylog\collector-sidecar\collector-id
cache_path: C:\Program Files\graylog\collector-sidecar\cache
log_path: C:\Program Files\graylog\collector-sidecar\logs
log_rotation_time: 86400
log_max_age: 604800
tags: [windows, iis]
backends:
    - name: nxlog
      enabled: false
      binary_path: C:\Program Files (x86)\nxlog\nxlog.exe
      configuration_path: C:\Program Files\graylog\collector-sidecar\generated\nxlog.conf
```


3.安装后，设置服务并启动。

```
$ "C:\Program Files\graylog\collector-sidecar\graylog-collector-sidecar.exe" -service install
$ "C:\Program Files\graylog\collector-sidecar\graylog-collector-sidecar.exe" -service start
```


4.安装nxlog。


5.配置nxlog.conf文件。

nxlog的配置文件存在一种配对关系，定义Input节、Output节、Route节
，下面的配置文件只定义了一个Input,Output的路由对应关系，nxlog是模块化的设计，我们在in这个Input节中，用了im_file这个模块，告诉nxlog去那里读取本地日志文件，我们这定义日志文件放到c:\rlog\下的所有.log文件。
```
<Extension _syslog>
    Module      xm_syslog
</Extension>

<Input in>
    Module    im_file 
    file    'C:\\rlog\\*.log'
    SavePos    TRUE
</Input>

<Output out>
    Module      om_udp
    Host        192.168.1.3
    Port        521
    Exec parse_syslog(); 
</Output>


<Route 1>
    Path        in => out
</Route>
```
名out的Output节定义的是输出才用什么协议，并解析成什么形式，使用om_udp模块，将本的日志文件以udp传输协议，输出成syslog形式，到指定的服务器,syslog服务器或是graylog的数据接收端口。


安装服务

```
nxlog -i
```

停止一下nxlog，如果启动了。


```
nxlog -s
```

在后端启动nxlog监听服务


```
nxlog -f
```


看一下默认的位置nxlog的启动log。

文件位置：C:\Program Files (x86)\nxlog\data

正常启动nxlog会显示下面的字样：

```
2017-08-16 17:02:15 INFO nxlog-ce-2.9.1716 started
```

如果出现这样的字段就OK了，如有其它警告和提示，可能是配置文件写错了。