---
layout: post
title: LVS负载均衡下的Openresty间的主从Redis同步
description: LVS负载均衡下的Openresty间的主从Redis同步
date:   2016-09-17 22:50:18 +0800 
categories: [topic]
---
LVS负载均衡下的Openresty间的主从redis同步

<h3>正文：</h3> 
像一般在多台提供相同服务的Openresty服务前端会挂F5或是Ha,做为负载均衡，因为逻辑关系有时会用共享使用一份Redis，如果这时，使用Redis的主从模式，就可以很好共享一份Redis服务的数据，但从时间上讲，还是存在数据同步的延时的问题。

简单说一下Redis的主从设置：

在redis安装的目录，或是etc下会找到redis的配置文件， redis.conf。只要在配置文件追加两句话，就可以配置主从模式。

```
slaveof 192.168.0.0.1 6379
masterauth password
```

<strong>slaveof</strong> ：子句后指定主服务器的地址和端口号。
<strong>masterauth</strong> ： 后跟主服务器的登陆密码。

设置后重起一下Redis：
```
redis-server /etc/redis.conf
```

分别登陆一下两台机器，简单的可以看一下数据是否同步。

```
redis-cli
>keys *
```


<h3>后记：</h3> 

在某种情况下，同一上HA后的两个Openresty服务，很可能不在一个大楼的网络里，这种互备的情况，当一台服务器出现问题时，另一台可以作备机，因为平时网络和其它原因，redis主从同步也是有延迟的，这样可以把服务都只向一台Redis机器，另外一台只做数据备份,需要时和实际业务进行挂载。